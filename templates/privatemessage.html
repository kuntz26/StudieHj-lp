{% extends "layout.html" %}

{% block title %}Private Messages{% endblock %}

{% block body %}
    <h3>Skriver til: <a href="/accounts/{{ other_username }}"></a>{{ other_username }}</h3>
    {% if messages %}
        <section class="msger">
            <main class="msger-chat">
                {% for message in messages %}
                    <div class="msg {% if message.senderid == session['user_id'] %}right-msg{% else %}left-msg{% endif %}">
                        <div class="msg-bubble">
                            <div class="msg-info">
                                <div class="msg-info-name">{{ message.username }}</div>
                                <div class="msg-info-time">{{ message.date }}</div>
                            </div>
                            <div class="msg-text">
                                {{ message.message }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </main>
            {% if other_username != "Slettet" %}
                <form class="msger-inputarea" action="/privatemessages/write" method="post">
                    <input type="hidden" name="username" value="{{ other_username }}">
                    <input autocomplete="off" type="text" class="msger-input" placeholder="Enter your message..." name="message">
                    <button type="submit" class="msger-send-btn">Send</button>
                </form>
            {% endif %}
        </section>
    {% endif %}
    <script>
        window.onload = function() {
            const chatContainer = document.querySelector('.msger-chat');
            if (chatContainer) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        };
    </script>

    <style>
        /* Additional Styling for Chat Window */
        .msger {
            border-radius: 8px; /* Slightly rounded corners for better design */
            box-shadow: 0 15px 20px rgba(0, 0, 0, 0.1);
            max-width: 900px;  /* Slightly larger to accommodate wide screen views */
        }

        /* Styling for Chat Container */
        .msger-chat {
            padding: 20px;
            background-color: var(--body-bg); /* Light background */
            border-radius: 5px;
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;  /* Smooth scrolling effect */
        }

        /* Styling for Messages */
        .msg-bubble {
            background-color: var(--left-msg-bg);
            color: #333;  /* Ensure dark text for readability */
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            line-height: 1.6;
            position: relative;
            word-wrap: break-word;
        }

        /* Align Sent (Right) Message */
        .right-msg .msg-bubble {
            background-color: var(--right-msg-bg);
            color: #fff;  /* White text on the right message bubble */
            border-radius: 15px;
            border-bottom-right-radius: 0;  /* Adjust for alignment */
        }

        /* Message Info Styling */
        .msg-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            margin-bottom: 8px;
        }

        .msg-info-name {
            font-weight: bold;
            color: #5c6ac4;  /* Slightly brighter for name */
        }

        .msg-info-time {
            color: #aaa;
        }

        /* User Image */
        .msg-img {
            border-radius: 50%;
            background-color: #ccc;
            margin-right: 10px;
            width: 50px;
            height: 50px;
            object-fit: cover;
        }

        /* Input Area Enhancements */
        .msger-inputarea {
            background-color: #f3f3f3; /* Light gray background for input */
            padding: 12px 20px;
            border-top: 2px solid #ddd;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Input Field Styles */
        .msger-input {
            width: 85%;
            padding: 12px;
            background-color: #f4f4f4;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1em;
            color: #333;
            transition: background-color 0.3s ease-in-out;
        }

        .msger-input:focus {
            background-color: #fff;
            outline: none;
            border-color: #5c6ac4;
        }

        /* Send Button Style */
        .msger-send-btn {
            padding: 12px 20px;
            background-color: rgb(0, 196, 65);
            color: white;
            font-weight: bold;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: background 0.3s ease-in-out;
        }

        .msger-send-btn:hover {
            background-color: rgb(0, 180, 50); /* Darker shade when hovering */
        }

        /* Hover Effects for Send Button */
        .msger-send-btn:active {
            background-color: rgb(0, 160, 45); /* Even darker on active click */
        }

        /* Custom Scrollbar */
        .msger-chat::-webkit-scrollbar {
            width: 8px;
        }

        .msger-chat::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .msger-chat::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .msger-chat::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
{% endblock %}
